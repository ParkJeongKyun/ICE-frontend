import { EncodingType } from '@/contexts/TabDataContext/TabDataContext';

/**
 * 바이트를 16진수 문자열로 변환
 */
export function byteToHex(byte: number): string {
  return ('0' + byte.toString(16)).slice(-2).toUpperCase();
}

/**
 * 바이트를 인코딩에 따른 문자로 변환
 */
export function byteToChar(byte: number, encoding: EncodingType): string {
  // 1. 제어 문자 (0x00-0x1F, 0x7F): 항상 점으로 표시
  if (byte < 0x20 || byte === 0x7f) {
    return '.';
  }

  // 2. ASCII 범위 (0x20-0x7E): 모든 인코딩에서 동일
  if (byte >= 0x20 && byte <= 0x7e) {
    return String.fromCharCode(byte);
  }

  // 3. 확장 영역 (0x80-0xFF): 인코딩별 처리
  switch (encoding) {
    case 'ascii':
      return '.';
    case 'ansi':
      return byteToAnsi(byte);
    case 'oem':
      return byteToOem(byte);
    case 'mac':
      return byteToMac(byte);
    case 'ebcdic':
      return byteToEbcdic(byte);
    default:
      return '.';
  }
}

// ==================== 인코딩별 변환 함수 ====================

/**
 * Windows-1252 (ANSI) 변환
 */
function byteToAnsi(byte: number): string {
  if (byte >= 0x80 && byte <= 0x9f) {
    const undefinedCodes = [0x81, 0x8d, 0x8f, 0x90, 0x9d];
    if (undefinedCodes.includes(byte)) return '.';

    const win1252Map: Record<number, number> = {
      0x80: 0x20ac,
      0x82: 0x201a,
      0x83: 0x0192,
      0x84: 0x201e,
      0x85: 0x2026,
      0x86: 0x2020,
      0x87: 0x2021,
      0x88: 0x02c6,
      0x89: 0x2030,
      0x8a: 0x0160,
      0x8b: 0x2039,
      0x8c: 0x0152,
      0x8e: 0x017d,
      0x91: 0x2018,
      0x92: 0x2019,
      0x93: 0x201c,
      0x94: 0x201d,
      0x95: 0x2022,
      0x96: 0x2013,
      0x97: 0x2014,
      0x98: 0x02dc,
      0x99: 0x2122,
      0x9a: 0x0161,
      0x9b: 0x203a,
      0x9c: 0x0153,
      0x9e: 0x017e,
      0x9f: 0x0178,
    };
    return String.fromCodePoint(win1252Map[byte] || byte);
  }
  return String.fromCharCode(byte);
}

/**
 * CP437 (OEM) 변환
 */
function byteToOem(byte: number): string {
  const cp437Map: Record<number, number> = {
    0x80: 0x00c7,
    0x81: 0x00fc,
    0x82: 0x00e9,
    0x83: 0x00e2,
    0x84: 0x00e4,
    0x85: 0x00e0,
    0x86: 0x00e5,
    0x87: 0x00e7,
    0x88: 0x00ea,
    0x89: 0x00eb,
    0x8a: 0x00e8,
    0x8b: 0x00ef,
    0x8c: 0x00ee,
    0x8d: 0x00ec,
    0x8e: 0x00c4,
    0x8f: 0x00c5,
    0x90: 0x00c9,
    0x91: 0x00e6,
    0x92: 0x00c6,
    0x93: 0x00f4,
    0x94: 0x00f6,
    0x95: 0x00f2,
    0x96: 0x00fb,
    0x97: 0x00f9,
    0x98: 0x00ff,
    0x99: 0x00d6,
    0x9a: 0x00dc,
    0x9b: 0x00a2,
    0x9c: 0x00a3,
    0x9d: 0x00a5,
    0x9e: 0x20a7,
    0x9f: 0x0192,
    0xa0: 0x00e1,
    0xa1: 0x00ed,
    0xa2: 0x00f3,
    0xa3: 0x00fa,
    0xa4: 0x00f1,
    0xa5: 0x00d1,
    0xa6: 0x00aa,
    0xa7: 0x00ba,
    0xa8: 0x00bf,
    0xa9: 0x2310,
    0xaa: 0x00ac,
    0xab: 0x00bd,
    0xac: 0x00bc,
    0xad: 0x00a1,
    0xae: 0x00ab,
    0xaf: 0x00bb,
    0xb0: 0x2591,
    0xb1: 0x2592,
    0xb2: 0x2593,
    0xb3: 0x2502,
    0xb4: 0x2524,
    0xb5: 0x2561,
    0xb6: 0x2562,
    0xb7: 0x2556,
    0xb8: 0x2555,
    0xb9: 0x2563,
    0xba: 0x2551,
    0xbb: 0x2557,
    0xbc: 0x255d,
    0xbd: 0x255c,
    0xbe: 0x255b,
    0xbf: 0x2510,
    0xc0: 0x2514,
    0xc1: 0x2534,
    0xc2: 0x252c,
    0xc3: 0x251c,
    0xc4: 0x2500,
    0xc5: 0x253c,
    0xc6: 0x255e,
    0xc7: 0x255f,
    0xc8: 0x255a,
    0xc9: 0x2554,
    0xca: 0x2569,
    0xcb: 0x2566,
    0xcc: 0x2560,
    0xcd: 0x2550,
    0xce: 0x256c,
    0xcf: 0x2567,
    0xd0: 0x2568,
    0xd1: 0x2564,
    0xd2: 0x2565,
    0xd3: 0x2559,
    0xd4: 0x2558,
    0xd5: 0x2552,
    0xd6: 0x2553,
    0xd7: 0x256b,
    0xd8: 0x256a,
    0xd9: 0x2518,
    0xda: 0x250c,
    0xdb: 0x2588,
    0xdc: 0x2584,
    0xdd: 0x258c,
    0xde: 0x2590,
    0xdf: 0x2580,
    0xe0: 0x03b1,
    0xe1: 0x00df,
    0xe2: 0x0393,
    0xe3: 0x03c0,
    0xe4: 0x03a3,
    0xe5: 0x03c3,
    0xe6: 0x00b5,
    0xe7: 0x03c4,
    0xe8: 0x03a6,
    0xe9: 0x0398,
    0xea: 0x03a9,
    0xeb: 0x03b4,
    0xec: 0x221e,
    0xed: 0x03c6,
    0xee: 0x03b5,
    0xef: 0x2229,
    0xf0: 0x2261,
    0xf1: 0x00b1,
    0xf2: 0x2265,
    0xf3: 0x2264,
    0xf4: 0x2320,
    0xf5: 0x2321,
    0xf6: 0x00f7,
    0xf7: 0x2248,
    0xf8: 0x00b0,
    0xf9: 0x2219,
    0xfa: 0x00b7,
    0xfb: 0x221a,
    0xfc: 0x207f,
    0xfd: 0x00b2,
    0xfe: 0x25a0,
    0xff: 0x00a0,
  };
  return String.fromCodePoint(cp437Map[byte] || byte);
}

/**
 * Mac Roman (Macintosh) 변환
 */
function byteToMac(byte: number): string {
  const macRomanMap: Record<number, number> = {
    0x80: 0x00c4,
    0x81: 0x00c5,
    0x82: 0x00c7,
    0x83: 0x00c9,
    0x84: 0x00d1,
    0x85: 0x00d6,
    0x86: 0x00dc,
    0x87: 0x00e1,
    0x88: 0x00e0,
    0x89: 0x00e2,
    0x8a: 0x00e4,
    0x8b: 0x00e3,
    0x8c: 0x00e5,
    0x8d: 0x00e7,
    0x8e: 0x00e9,
    0x8f: 0x00e8,
    0x90: 0x00ea,
    0x91: 0x00eb,
    0x92: 0x00ed,
    0x93: 0x00ec,
    0x94: 0x00ee,
    0x95: 0x00ef,
    0x96: 0x00f1,
    0x97: 0x00f3,
    0x98: 0x00f2,
    0x99: 0x00f4,
    0x9a: 0x00f6,
    0x9b: 0x00f5,
    0x9c: 0x00fa,
    0x9d: 0x00f9,
    0x9e: 0x00fb,
    0x9f: 0x00fc,
    0xa0: 0x2020,
    0xa1: 0x00b0,
    0xa2: 0x00a2,
    0xa3: 0x00a3,
    0xa4: 0x00a7,
    0xa5: 0x2022,
    0xa6: 0x00b6,
    0xa7: 0x00df,
    0xa8: 0x00ae,
    0xa9: 0x00a9,
    0xaa: 0x2122,
    0xab: 0x00b4,
    0xac: 0x00a8,
    0xad: 0x2260,
    0xae: 0x00c6,
    0xaf: 0x00d8,
    0xb0: 0x221e,
    0xb1: 0x00b1,
    0xb2: 0x2264,
    0xb3: 0x2265,
    0xb4: 0x00a5,
    0xb5: 0x00b5,
    0xb6: 0x2202,
    0xb7: 0x2211,
    0xb8: 0x220f,
    0xb9: 0x03c0,
    0xba: 0x222b,
    0xbb: 0x00aa,
    0xbc: 0x00ba,
    0xbd: 0x03a9,
    0xbe: 0x00e6,
    0xbf: 0x00f8,
    0xc0: 0x00bf,
    0xc1: 0x00a1,
    0xc2: 0x00ac,
    0xc3: 0x221a,
    0xc4: 0x0192,
    0xc5: 0x2248,
    0xc6: 0x2206,
    0xc7: 0x00ab,
    0xc8: 0x00bb,
    0xc9: 0x2026,
    0xca: 0x00a0,
    0xcb: 0x00c0,
    0xcc: 0x00c3,
    0xcd: 0x00d5,
    0xce: 0x0152,
    0xcf: 0x0153,
    0xd0: 0x2013,
    0xd1: 0x2014,
    0xd2: 0x201c,
    0xd3: 0x201d,
    0xd4: 0x2018,
    0xd5: 0x2019,
    0xd6: 0x00f7,
    0xd7: 0x25ca,
    0xd8: 0x00ff,
    0xd9: 0x0178,
    0xda: 0x2044,
    0xdb: 0x20ac,
    0xdc: 0x2039,
    0xdd: 0x203a,
    0xde: 0xfb01,
    0xdf: 0xfb02,
    0xe0: 0x2021,
    0xe1: 0x00b7,
    0xe2: 0x201a,
    0xe3: 0x201e,
    0xe4: 0x2030,
    0xe5: 0x00c2,
    0xe6: 0x00ca,
    0xe7: 0x00c1,
    0xe8: 0x00cb,
    0xe9: 0x00c8,
    0xea: 0x00cd,
    0xeb: 0x00ce,
    0xec: 0x00cf,
    0xed: 0x00cc,
    0xee: 0x00d3,
    0xef: 0x00d4,
    0xf0: 0xf8ff,
    0xf1: 0x00d2,
    0xf2: 0x00da,
    0xf3: 0x00db,
    0xf4: 0x00d9,
    0xf5: 0x0131,
    0xf6: 0x02c6,
    0xf7: 0x02dc,
    0xf8: 0x00af,
    0xf9: 0x02d8,
    0xfa: 0x02d9,
    0xfb: 0x02da,
    0xfc: 0x00b8,
    0xfd: 0x02dd,
    0xfe: 0x02db,
    0xff: 0x02c7,
  };
  return String.fromCodePoint(macRomanMap[byte] || byte);
}

/**
 * EBCDIC (IBM037) 변환
 */
function byteToEbcdic(byte: number): string {
  const ebcdicMap: Record<number, number> = {
    0x40: 0x20,
    0x4a: 0x5b,
    0x4b: 0x2e,
    0x4c: 0x3c,
    0x4d: 0x28,
    0x4e: 0x2b,
    0x4f: 0x7c,
    0x50: 0x26,
    0x5a: 0x21,
    0x5b: 0x24,
    0x5c: 0x2a,
    0x5d: 0x29,
    0x5e: 0x3b,
    0x5f: 0x5e,
    0x60: 0x2d,
    0x61: 0x2f,
    0x6a: 0x7c,
    0x6b: 0x2c,
    0x6c: 0x25,
    0x6d: 0x5f,
    0x6e: 0x3e,
    0x6f: 0x3f,
    0x79: 0x60,
    0x7a: 0x3a,
    0x7b: 0x23,
    0x7c: 0x40,
    0x7d: 0x27,
    0x7e: 0x3d,
    0x7f: 0x22,
    0x81: 0x61,
    0x82: 0x62,
    0x83: 0x63,
    0x84: 0x64,
    0x85: 0x65,
    0x86: 0x66,
    0x87: 0x67,
    0x88: 0x68,
    0x89: 0x69,
    0x91: 0x6a,
    0x92: 0x6b,
    0x93: 0x6c,
    0x94: 0x6d,
    0x95: 0x6e,
    0x96: 0x6f,
    0x97: 0x70,
    0x98: 0x71,
    0x99: 0x72,
    0xa2: 0x73,
    0xa3: 0x74,
    0xa4: 0x75,
    0xa5: 0x76,
    0xa6: 0x77,
    0xa7: 0x78,
    0xa8: 0x79,
    0xa9: 0x7a,
    0xc1: 0x41,
    0xc2: 0x42,
    0xc3: 0x43,
    0xc4: 0x44,
    0xc5: 0x45,
    0xc6: 0x46,
    0xc7: 0x47,
    0xc8: 0x48,
    0xc9: 0x49,
    0xd1: 0x4a,
    0xd2: 0x4b,
    0xd3: 0x4c,
    0xd4: 0x4d,
    0xd5: 0x4e,
    0xd6: 0x4f,
    0xd7: 0x50,
    0xd8: 0x51,
    0xd9: 0x52,
    0xe2: 0x53,
    0xe3: 0x54,
    0xe4: 0x55,
    0xe5: 0x56,
    0xe6: 0x57,
    0xe7: 0x58,
    0xe8: 0x59,
    0xe9: 0x5a,
    0xf0: 0x30,
    0xf1: 0x31,
    0xf2: 0x32,
    0xf3: 0x33,
    0xf4: 0x34,
    0xf5: 0x35,
    0xf6: 0x36,
    0xf7: 0x37,
    0xf8: 0x38,
    0xf9: 0x39,
  };
  return String.fromCodePoint(ebcdicMap[byte] || 0x2e);
}
